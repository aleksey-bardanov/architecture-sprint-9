### Название задачи: MVP Интернет-банк

### Автор: Алексей Барданов

### Дата: 04.05.2025

### Функциональные требования

Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
| UC1 | Клиент, Cайт банка, Интернет-банк, АБС | Заявка на открытие депозита | 1. Клиент на сайте переходит на страницу открытия депозита <br/> 2. Сайт переадресует клиента на страницу регистрации интернет-банка <br/> 3. Клиент вводит ФИО, телефон и пароль <br/> 4. Интернет-банк отправляет клиенту короткий СМС код </br> 5. Клиент вводит код <br/> 6. При успехе клиент возвращается на главную страницу сайта, а интернет-банк создает заявку в АБС |
| UC2 | Клиент, Интернет-банк | Авторизация | 1. Зарегистрированный клиент переходит на  сайт интернет-банка, вводит логин и пароль <br/> 2. Интернет-банк отправляет клиенту короткий СМС код </br> 3. Клиент вводит код <br/> 4. При успехе клиент переводится на главную страницу интернет-банка |
| UC3 | Клиент, Интернет-банк, АБС | Просмотр предложений | 1. Авторизованный клиент находится на сайте интернет-банка <br/> 2. Клиент просматривает актуальные ставки по депозитам 3. Интернет банк обращается в АБС за данными, включая персональные предложения для конкретного клиента и отображает их на странице |
| UC4 | Клиент, Интернет-банк, АБС | Открытие депозита | 1. Авторизованный клиент выбирает предложение по депозиту <br/> 2. Интернет-банк отправляет клиенту короткий СМС код 3. Клиент вводит код <br/> 4. В случае успеха интернет-банк создает заявку в АБС |
| UC5 | Клиент, Интернет-банк, Менеджер фронт-офиса | Подтверждение личности | 1. Клиент предоставляет менеджеру фронт-офиса необходимый набор документов <br/> 2. Если документы в порядке менеджер фронт-офиса подтверждает возможность открытия депозита через панель администратора |

### Нефункциональные требования

Опишите здесь нефункциональные требования и архитектурно-значимые требования.

|**№**|**Требование**|
| :-: | :- |
| **R** | **Надежность** |
| R1 | Все сервисы должны работать 24/7 и быть доступны в 99,9% |
| R2 | В случае сбоев в ЦОД необходимо, чтобы сервисы интернет-банка были доступны и выдерживали требуемую нагрузку |
| R3 | При росте нагрузки должно выполняться равномерное горизонтальное масштабирование и распределение запросов между серверами. Обеспечивается при использовании микросервисной архитектуры для функционала открытия депозитов online |
| R4 | Для обеспечения требуемой доступности сервиса лучше избежать синхронной работы интернет-банка с API АБС в новом процессе и использовать асинхронную коммуникацию |
| **P** | **Производительность** |
| P1 | При проведении платежей справочные данные должны загружаться не более чем за 100 мс в 95% случаев |
| **+R** | **Ограничения** |
| +R1 | Чувствительные данные (например личные данные клиентов) должны передаваться между сайтом/клиентом и интернет-банком/клиентом только в зашифрованном виде |
| +R2 | Предпочтительные технологии: PHP, React.js, C#, ASP.NET, MS SQL, Oracle |
| +R3 | Процесс обработки заявок, а также доступ к актуальным ставкам по депозитам должны быть реализованы в АБС |
| +R4 | В качестве брокера сообщений предпочтительной технологией является Apache Kafka |
| +R5 | Из-за базы данных АБС может масштабироваться только вертикально |

### Решение

[Диаграмма контекста](./ContextC4.puml)
[Диаграмма контейнеров](./ContainerC4.puml)

После того как клиент оставит заявку на открытие депозита, требуется, чтобы ему позвонил оператор кол-центра, предложил особые условия и пригласил в банк. Для этого нужно, чтобы менеджер бэк офиса обработал заявку, получил от специалиста по кредитам специальные условия и оставил заявку на звонок в системе кол-центра. Так как эти операции не требуют вмешательства интернет-банка или они отражены только на схеме контекста, но не на диаграмме контейнеров.

Работа интернет-банка требует реализации функционала идентификации, аутентификации и авторизации клиента, эти обязанности можно реализовать в существующем приложении на схеме обозначено как *Сервис авторизации*, так как будет выполнять главным образом эти функции. Для управления депозитами предлагается выделить отдельный сервис, предоставляющий API для создания заявок и открытия депозитов, а также для обновления персональных предложений и актуальных ставок. *Сервис авторизации* выдает веб приложению JWT, который требуется для использования API *Сервиса депозитов*. В зависимости от роли клиента (подтверждена личность или нет) он может либо оставить заявку на открытие депозита, либо открыть депозит. Подтвердить личность клиента может менеджер фронт-офиса, через *Панель администратора*. Эта же панель используется менеджером отдела кредитования для актуализации ставок по депозитам. Разрешения на работу с тем или иным API выдаются сервисом авторизации в соответствии с ролями сотрудников.

Данные по депозитам клиентов в обезличенном виде хранятся в базе данных интернет-банка. В отдельной базе данных хранится информация аккаунтов клиентов.

### Альтернативы

- **Event-driven**. Можно было бы построить событийно-ориентированную архитектуру, т.к. в системе происходят события, меняющие ее состояние, например *создание заявки*, или *обновление актуальных ставок*. Тогда можно было бы обмениваться информацией между сервисами через брокер, это упростило бы работу при большом количестве сервисов, однако на данном этапе в системе планируется всего один сервис, выполняющий бизнес-логику, поэтому можно исключить этот вариант.

- **Отдельный сервис уведомлений**. Можно было бы вынести уведомления в отдельный сервис, но на этапе MVP это дополнительные трудозатраты. В перспективе такой сервис был бы полезен для уведомления клиентов о различных событиях с депозитами по разным каналам (не только СМС, но и почта или PUSH).

- **Кеширование актуальных ставок по депозитам**. Можно было бы добавить кеширование актуальных ставок по депозитам либо на стороне АБС, либо на стороне интернет-банка, это бы ускорило отклик системы при отображении данных пользователю, но с малым количеством клиентов тратить ресурс команды на это преждевременно. Актуальные значения ставок по депозитам можно было бы кешировать при каждой записи БД (политика cache-through), при этом значения всегда будут актуальными потребуется меньше обращений к базе данных.

- **Использование основной базы данных АБС для хранения заявок клиентов и персональных предложений**. Это решение немного упростило бы структуру контейнеров и взаимодействий, но это решение плохо масштабируется, а есть задача предусмотреть дальнейшее расширение системы, а также возможность горизонтального масштабирования, основная база данных масштабируется только вертикально. При использовании отдельной БД в рамках системы АБС:
  - Актуальные ставки по депозитам хранятся в информационной системе, а на в XLS. Они доступны менеджерам по кредитам и менеджерам по депозитам
  - Имеется возможность шардирования БД, при росте нагрузки это обеспечит большую доступность сервиса
  - Имеется возможность обеспечения высокой доступности сервиса за счет распределения шардов БД по ЦОД в разных регионах

#### Недостатки, ограничения, риски

- **Большой объем разработки для MVP**. Предлагаемое решение требует разработки двух сервисов (авторизации и депозитов), двух веб-приложений (пользовательского и админского), а также интеграции существующего приложения АБС с API разрабатываемых сервисов. 

- **В команде нет специалистов по DevOps**. Обеспечение высокой доступности и масштабируемости может быть достигнуто за счет использование Kubernetes и подхода IaC, но для этого нужно ввести в команду соответствующих специалистов.

- **Обучение специалистов**. Изменится рабочий процесс всех специалистов банка, как бэк, так и фронт-офиса, потребуется дополнительное обучение сотрудников.

- **Существующие депозиты в базе данных АБС**. Сейчас информация о существующих депозитах хранится в старой базе данных. Требуется продумать либо миграцию этх данных в новую бд, либо разделение депозитов клиентов, пользующихся интернет-банком и остальных, либо другие способы решения этого вопроса.