### Название задачи: MVP Передача справок в кол-центр

### Автор: Алексей Барданов

### Дата: 11.05.2025

### Функциональные требования

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
| UC1 | Клиент, Оператор кол-центра банка, Система кол-центра | Получение консультации по ставкам | 1. Клиент звонит в кол-центр и запрашивает актуальные ставки по депозитам <br/> 2. Оператор кол-центра получает актуальные данные о ставках из фала, переданного в систему кол-центра <br/> 3. Оператор консультирует клиента по ставкам депозитов |
| UC2 | Менеджер отдела кредитования, Интернет-банк, Система кол-центра | Передача ставок в кол-центр | 1. Менеджер отдела кредитования обновляет информацию о ставках по депозитам в системе интернет-банка <br/> 2. В системе интернет-банка автоматически формируется файл с актуальными ставками по депозитам и передается по протоколу SFTP в системы кол-центров |

### Нефункциональные требования

|**№**|**Требование**|
| :-: | :- |
| **R** | **Надежность** |
| R1 | Все сервисы должны работать 24/7 и быть доступны в 99,9% |
| **P** | **Производительность** |
| P1 | При проведении платежей справочные данные должны загружаться не более чем за 100 мс в 95% случаев |
| **+R** | **Ограничения** |
| +R1 | Нет возможности сделать API-вызовы |
| +R2 | Предпочтительный способ передачи актуальных ставок - файлом через SFTP |

### Решение

[Диаграмма контекста](./ContextC4.puml)
[Диаграмма контейнеров](./ContainerC4.puml)

Для решения задачи своевременного обновления ставок по депозитам в кол-центрах можно воспользоваться существующим решением по интернет банку. Менеджер отдела кредитования в соответствие со своими рабочими обязанностями периодически обновляет информацию по ставкам. Источником актуальных ставок является система интернет банка. Она же может по событию обновления ставок сформировать файл с актуальными значениями и передать заинтересованным системам по протоколу SFTP.

Копия сформированного файла также сохраняется в хранилище файлов, чтобы в случае непредвиденных обстоятельств можно было выполнить бэкап. Копии целесообразно хранить некоторое время и ранжировать на случай расследования инцидентов.

### Альтернативы

- **Открытый API**. Можно было бы поддерживать ендпойнт для получения актуальных ставок на уровне сервиса депозитов, но этот способ не доступен.

- **Доступ к хранилищу файлов**. Можно было бы предоставить партнерам доступ к хранилищу файлов. При этом бы не потребовалось организовывать передачу фалов, системы кол-центров обращались бы к фалам напрямую, но такой способ нарушает принцип минимально необходимой осведомленности и предоставляет сторонней системе больше информации, чем ей требуется. Это может привести к ошибкам и стать вектором для атаки на систему интернет банка.

- **rsync**. Можно использовать эту утилиту вместо протокола SFTP, но потребуется дополнительная настройка на стороне принимающей системы. Также этот способ обмена работает немного медленнее. Преимуществом его является возможность автоматически восстановить передачу при обрыве соединения.

- **S3 хранилище**. Можно использовать не файловое, а объектное хранилище, но в текущей ситуации преимуществ от принятия этого решения не наблюдается, так как речь идет о хранении небольшого количества текстовых файлов малого размера.

### Недостатки, ограничения, риски

- **Защищенное соединение**. Между системой банка и системой партнерского кол-центра требуется установить защищенное соединение поверх которого будет работать передача, например можно использовать VPN. А системе партнерского кол-центра (как и собственного кол центра банка) нужно будет поднять SSH сервер и добавить SSH ключ для приема файлов с актуальными депозитами.

- **Случайное/преднамеренное искажение информация**. Если не предпринять меры, то по переданный файл можно будет поменять "руками" случайно или специально. Для того, чтобы этого избежать можно предусмотреть: 
  - *Периодическое обновление файла в удаленной системе* - файл будет актуализироваться через равные промежутки времени
  - *Ограничение доступа к переданному файлу* - переданный фалд доступен для изменения только администратору системы
  - *rsync* - функционал утилиты предусматривает контроль состояния переданного файла и автоматическое обновление в случае изменения файла